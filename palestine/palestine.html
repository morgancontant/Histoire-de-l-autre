<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>PDF - Protection basique</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
    color: #fff;
    /* UNIQUE dégradé couvrant toute la page */
    background: linear-gradient(135deg, #007a3d 0%, #b5121b 100%);
    background-attachment: fixed;
    background-size: cover;
  }

  /* Header simple, semi-transparent pour rester lisible sur le dégradé */
  header {
    padding: 12px 16px;
    background: rgba(0,0,0,0.20);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    box-shadow: 0 4px 12px rgba(0,0,0,0.35);
    backdrop-filter: blur(4px);
  }
  header h1 {
    margin: 0;
    font-size: 16px;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  /* Conteneur central, sans fond blanc ni superposition multiple */
  #pdf-container {
    padding: 18px;
    max-width: 1100px;
    margin: 40px auto;
    text-align: center;
  }

  /* PDF rendu sur canvas */
  canvas {
    display: block;
    margin: 18px auto;
    box-shadow: 0 10px 30px rgba(0,0,0,0.35);
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    background: transparent; /* assure qu'il n'y a pas de fond blanc ajouté */
  }

  /* Empêche la sélection (comme avant) */
  .no-select, body, #pdf-container, canvas {
    user-select: none;
    -webkit-user-select: none;
    -ms-user-select: none;
    -moz-user-select: none;
  }

  /* Masque la couche textuelle PDF.js si présente */
  .textLayer { display: none !important; }

  /* Écran noir si devtools détectés */
  #shield {
    display: none;
    position: fixed;
    inset: 0;
    background: #000;
    color: #fff;
    z-index: 99999;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    text-align: center;
    padding: 20px;
  }

  /* Bouton retour = style .card a (vert->rouge hover) */
  button {
    display: inline-block;
    padding: 12px 25px;
    background: #007a3d; /* vert */
    color: #fff;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    text-decoration: none;
    transition: all 0.25s ease;
    font-size: 1rem;
    cursor: pointer;
  }
  button:hover {
    background: #b5121b; /* rouge */
    color: #fff;
    transform: scale(1.06);
  }

  @media (max-width: 768px) {
    #pdf-container { margin: 24px 12px; }
    header { padding: 10px 12px; }
  }
</style>
</head>
<body class="no-select">
<header>
  <h1>Document — Lecture Palestine</h1>
  <div>
    <button id="back-btn">⬅ Retour</button>
  </div>
</header>

<div id="pdf-container" aria-live="polite"></div>

<!-- écran noir de protection si devtools detecté -->
<div id="shield">Affichage masqué pour protection — veuillez fermer les outils développeur / console pour revoir le document.</div>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
/* ========== CONFIG ========== */
const PDF_URL ='Palestine 3.0.pdf'; // Remplace par ton PDF (même dossier)
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const container = document.getElementById('pdf-container');
const shield = document.getElementById('shield');
const backBtn = document.getElementById('back-btn');

/* ========== RENDU PDF SUR CANVAS (texte non-sélectionnable) ========== */
(async function renderPdf() {
  try {
    const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
      const page = await pdf.getPage(pageNum);
      const scale = 1.3;
      const viewport = page.getViewport({ scale });

      const canvas = document.createElement('canvas');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      canvas.style.maxWidth = '100%';
      canvas.setAttribute('data-page', pageNum);
      canvas.setAttribute('draggable', 'false');

      const ctx = canvas.getContext('2d');
      await page.render({ canvasContext: ctx, viewport }).promise;

      // Empêcher le drag/drop/click droit sur le canvas
      canvas.addEventListener('dragstart', e => e.preventDefault());
      canvas.addEventListener('contextmenu', e => e.preventDefault());
      canvas.addEventListener('mousedown', e => { if (e.button === 2) e.preventDefault(); });

      container.appendChild(canvas);
    }
  } catch (err) {
    console.error('Erreur chargement PDF:', err);
    container.innerHTML = '<div style="color:red">Impossible de charger le PDF. Vérifie le chemin et lance via HTTP.</div>';
  }
})();

/* ===== Bouton retour ===== */
backBtn.addEventListener('click', () => {
  if (history.length > 1) history.back();
  else window.location.href = 'palestine.html';
});

/* ===== Protections (uniquement PC) ===== */
if (!isMobile) {
  // Blocage clic droit & drag
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('dragstart', e => e.preventDefault());

  // Blocage raccourcis clavier
  document.addEventListener('keydown', e => {
    if (e.key === 'F12') return e.preventDefault();
    if (e.ctrlKey && e.shiftKey && ['I','J','C','i','j','c'].includes(e.key)) return e.preventDefault();
    if (e.ctrlKey && ['u','U','s','S','p','P'].includes(e.key)) return e.preventDefault();
    if (e.ctrlKey && ['a','A'].includes(e.key)) return e.preventDefault();
  });

  // Détection DevTools
  let devtoolsOpen = false;
  function checkDevTools() {
    const threshold = 160;
    const widthDiff = Math.abs(window.outerWidth - window.innerWidth);
    const heightDiff = Math.abs(window.outerHeight - window.innerHeight);
    if (widthDiff > threshold || heightDiff > threshold) {
      if (!devtoolsOpen) {
        devtoolsOpen = true;
        shield.style.display = 'flex';
      }
    } else {
      if (devtoolsOpen) {
        devtoolsOpen = false;
        shield.style.display = 'none';
      }
    }
  }
  setInterval(checkDevTools, 500);

  // Masque si perte de focus
  window.addEventListener('blur', () => {
    shield.style.display = 'flex';
    shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
  });
  window.addEventListener('focus', () => { shield.style.display = 'none'; });

  // Détection capture
  document.addEventListener('keydown', e => {
    if (e.key === 'PrintScreen') {
      e.preventDefault();
      shield.style.display = 'flex';
      shield.innerHTML = 'Capture d’écran détectée et bloquée.';
      setTimeout(() => shield.style.display = 'none', 3000);
    }
  });

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      shield.style.display = 'flex';
      shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
    } else {
      shield.style.display = 'none';
    }
  });

  console.log('%cAttention : ouverture de la console peut entraîner le masquage du document.', 'background:#222;color:#bada55;padding:6px;border-radius:4px');
} else {
  // Sur mobile : aucune restriction
  document.body.classList.remove('no-select');
  shield.style.display = 'none';
}
</script>

<script>
/* =========================
   PROTECTIONS SUPPLÉMENTAIRES
   ========================= */

// Masque le PDF si la fenêtre perd le focus (ex. tentative de capture)
window.addEventListener('blur', () => {
  shield.style.display = 'flex';
  shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
});

// Réaffiche le PDF quand la fenêtre revient au premier plan
window.addEventListener('focus', () => {
  shield.style.display = 'none';
});

// Détection de tentative de capture clavier
document.addEventListener('keydown', e => {
  // Windows + Shift + S
  if (e.key === 'S' && e.shiftKey && e.metaKey === false && e.ctrlKey === false) {
    e.preventDefault();
    alert('Capture d’écran bloquée.');
    return false;
  }

  // Print Screen (certains navigateurs)
  if (e.key === 'PrintScreen') {
    e.preventDefault();
    shield.style.display = 'flex';
    shield.innerHTML = 'Capture d’écran détectée et bloquée.';
    setTimeout(() => shield.style.display = 'none', 3000);
  }
});

// Tentative d'ouverture d'outil de capture (visibilité du document)
document.addEventListener('visibilitychange', () => {
  if (document.hidden) {
    shield.style.display = 'flex';
    shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
  } else {
    shield.style.display = 'none';
  }
});
</script>

</body>
</html>
