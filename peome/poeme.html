<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<title>PDF - Protection basique</title>
<style>
  html, body {
    height: 100%;
    margin: 0;
    font-family: Arial, Helvetica, sans-serif;
background: linear-gradient(135deg,
  #7faeea 0%,   /* Bleu pastel Israël */
  #9fd8ff 25%,  /* Bleu clair pastel Israël */
  #8cd4a3 60%,  /* Vert pastel Palestine */
  #e38a8a 100%  /* Rouge pastel Palestine */
);
    background-attachment: fixed;
    background-repeat: no-repeat;
    background-size: cover;
    color: #fff;
  }

  header {
    padding: 12px 16px;
    background: rgba(0,0,0,0.25);
    color: #fff;
    display: flex;
    align-items: center;
    justify-content: space-between;
    backdrop-filter: blur(5px);
  }

  header h1 {
    margin: 0;
    font-size: 16px;
        text-transform: uppercase;
  }

  #pdf-container {
    padding: 18px;
    max-width: 1100px;
    margin: 0 auto;
  }

  canvas {
    display: block;
    margin: 18px auto;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.3);
    max-width: 100%;
    height: auto;
    border-radius: 8px;
  }

   .textLayer {
    display: none !important;
  }

  #shield {
    display: none;
    position: fixed;
    inset: 0;
    background: #000;
    color: #fff;
    z-index: 99999;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    text-align: center;
    padding: 20px;
  }
  button {
    cursor: pointer;
    padding: 12px 25px;
    border-radius: 6px;
    border: 0;
    background: #fff;
    color: #333;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    text-decoration: none;
    transition: all 0.3s ease;
    font-size: 1rem;
    cursor: pointer;

  }

  button:hover {
    background: #0038a8;
    color: #fff;
    transform: scale(1.1);
  }
</style>
</head>
<body class="no-select">
<header>
  <h1>Document — Poème</h1>
  <div>
    <button id="back-btn">⬅ Retour</button>
  </div>
</header>

<div id="pdf-container" aria-live="polite"></div>

<!-- écran noir de protection -->
<div id="shield">Affichage masqué pour protection — veuillez fermer les outils développeur / console pour revoir le document.</div>

<!-- PDF.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
<script>
/* ===== Détection mobile ===== */
const isMobile = /Mobi|Android|iPhone|iPad|iPod|Windows Phone/i.test(navigator.userAgent);

/* ===== Config PDF ===== */
const PDF_URL = 'Et la terre a tremblé.pdf';
pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

const container = document.getElementById('pdf-container');
const shield = document.getElementById('shield');
const backBtn = document.getElementById('back-btn');

/* ===== Rendu PDF ===== */
(async function renderPdf() {
  try {
    const pdf = await pdfjsLib.getDocument(PDF_URL).promise;
    for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
      const page = await pdf.getPage(pageNum);
      const scale = isMobile ? 1.0 : 1.3;
      const viewport = page.getViewport({ scale });

      const canvas = document.createElement('canvas');
      canvas.width = viewport.width;
      canvas.height = viewport.height;
      canvas.style.maxWidth = '100%';
      canvas.setAttribute('data-page', pageNum);

      const ctx = canvas.getContext('2d');
      await page.render({ canvasContext: ctx, viewport }).promise;

      container.appendChild(canvas);
    }
  } catch (err) {
    console.error('Erreur chargement PDF:', err);
    container.innerHTML = '<div style="color:red">Impossible de charger le PDF. Vérifie le chemin et lance via HTTP.</div>';
  }
})();

/* ===== Bouton retour ===== */
backBtn.addEventListener('click', () => {
  if (history.length > 1) history.back();
  else window.location.href = '';
});

/* ===== Protections (uniquement PC) ===== */
if (!isMobile) {
  // Blocage clic droit & drag
  document.addEventListener('contextmenu', e => e.preventDefault());
  document.addEventListener('dragstart', e => e.preventDefault());

  // Blocage raccourcis clavier
document.addEventListener('keydown', function(e) {
  const key = e.key.toLowerCase();
  const isMac = navigator.platform.toUpperCase().includes('MAC');
  const isCtrl = e.ctrlKey;
  const isCmd = e.metaKey; // touche ⌘ sur macOS

  // Bloque F12
  if (key === 'f12') { e.preventDefault(); e.stopPropagation(); return false; }

  // Bloque DevTools : Ctrl+Shift+I/J/C ou ⌘+Option+I/J/C
  if ((isCtrl || isCmd) && e.shiftKey && ['i','j','c'].includes(key)) { e.preventDefault(); return false; }

  // Bloque affichage du code source et sauvegarde : Ctrl/⌘ + U, S, P
  if ((isCtrl || isCmd) && ['u','s','p'].includes(key)) { e.preventDefault(); return false; }

  // Bloque Ctrl+A / ⌘+A (sélection tout)
  if ((isCtrl || isCmd) && key === 'a') { e.preventDefault(); return false; }

  // Bloque capture (Windows + Shift + S)
  if (isCtrl && e.shiftKey && key === 's' && !isMac) {
    e.preventDefault();
    alert('Capture d’écran bloquée.');
    return false;
  }

  // Sur macOS : ⌘+Shift+4 (capture d’écran)
  if (isCmd && e.shiftKey && key === '4') {
    e.preventDefault();
    alert('Capture d’écran bloquée sur macOS.');
    return false;
  }
});

  // Détection DevTools
  let devtoolsOpen = false;
  function checkDevTools() {
    const threshold = 160;
    const widthDiff = Math.abs(window.outerWidth - window.innerWidth);
    const heightDiff = Math.abs(window.outerHeight - window.innerHeight);
    if (widthDiff > threshold || heightDiff > threshold) {
      if (!devtoolsOpen) {
        devtoolsOpen = true;
        shield.style.display = 'flex';
      }
    } else {
      if (devtoolsOpen) {
        devtoolsOpen = false;
        shield.style.display = 'none';
      }
    }
  }
  setInterval(checkDevTools, 500);

  // Masque si perte de focus
  window.addEventListener('blur', () => {
    shield.style.display = 'flex';
    shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
  });
  window.addEventListener('focus', () => { shield.style.display = 'none'; });

  // Détection capture
  document.addEventListener('keydown', e => {
    if (e.key === 'PrintScreen') {
      e.preventDefault();
      shield.style.display = 'flex';
      shield.innerHTML = 'Capture d’écran détectée et bloquée.';
      setTimeout(() => shield.style.display = 'none', 3000);
    }
  });

  document.addEventListener('visibilitychange', () => {
    if (document.hidden) {
      shield.style.display = 'flex';
      shield.innerHTML = 'Affichage masqué pour protection — veuillez revenir sur la page.';
    } else {
      shield.style.display = 'none';
    }
  });

  console.log('%cAttention : ouverture de la console peut entraîner le masquage du document.', 'background:#222;color:#bada55;padding:6px;border-radius:4px');
} else {
  // Sur mobile : aucune restriction
  document.body.classList.remove('no-select');
  shield.style.display = 'none';
}
</script>
</body>
</html>
